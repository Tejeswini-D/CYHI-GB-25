<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Roulette</title>
<style>
  :root {
    --bg: #0f121a;
    --panel: #151d28;
    --accent: #22c55e;       
    --accent-2: #4ade80;       
    --text: #e8fbe8;
    --muted: #a5d7a7;
    --shadow: 0 10px 30px rgba(0, 255, 100, 0.2);
    --radius: 16px;
  }
  body {
    margin: 0;
    font-family: 'Press Start 2P',monospace;
    background: radial-gradient(1200px 800px at 20% -10%, #102515, var(--bg));
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  .wheel-container {
    position: relative;
    display: inline-block;
    box-shadow: var(--shadow);
    border-radius: 50%;
    background: var(--panel);
    padding: 8px;
  }
  .pointer {
    width: 0;
    height: 0;
    border-top: 20px solid transparent;
    border-bottom: 20px solid transparent;
    border-right: 40px solid var(--accent); 
    position: absolute;
    top: 50%;
    left: 100%;
    transform: translateY(-50%);
    z-index: 10;
  }
  canvas {
    border-radius: 50%;
    border: 4px solid rgba(255, 255, 255, 0.05);
    transition: transform 4s cubic-bezier(.18, .9, .24, 1);
    background: #121e15;
  }
  .controls {
    margin-top: 24px;
    text-align: center;
    background: var(--panel);
    padding: 16px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,.05);
  }

  input {
    padding: 10px 12px;
    border-radius: 12px;
    background: #0d1c12;
    color: var(--text);
    border: 1px solid rgba(255,255,255,.08);
    margin: 6px;
    outline: none;
  }
  input::placeholder {
    color: var(--muted);
  }
  button {
    margin-top: 12px;
    padding: 10px 16px;
    font-size: 16px;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    color: #031208;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    filter: drop-shadow(0 6px 12px rgba(34, 255, 123, 0.3));
  }
  button:hover {
    opacity: 0.9;
  }

  .result {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
    color: var(--accent-2);
  }
</style>
</head>
<body>
  <div class="wheel-container">
    <div class="pointer"></div>
    <canvas id="wheel" width="300" height="300"></canvas>
  </div>

  <div class="controls">
    <input type="text" id="taskInput" placeholder="Enter task">
    <button onclick="addTask()">Add Task</button><br>
    <button onclick="spin()">Spin</button>
    <div class="result" id="result">No result yet</div>
  </div>
  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const result = document.getElementById("result");
    let tasks = [];
    let currentRotation = 0;
    const colors = ["#22c55e", "#4ade80", "#86efac", "#16a34a", "#2dd4bf", "#059669"];
    function drawWheel() {
      const r = canvas.width / 2;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (tasks.length === 0) return;
      const slice = 2 * Math.PI / tasks.length;
      tasks.forEach((task, i) => {
        const start = i * slice - Math.PI / 2;
        const end = start + slice;
        ctx.beginPath();
        ctx.moveTo(r, r);
        ctx.arc(r, r, r, start, end);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.stroke();
        ctx.save();
        ctx.translate(r, r);
        ctx.rotate(start + slice / 2);
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "black";
        ctx.font = "14px Arial";
        ctx.fillText(task, r - 10, 0);
        ctx.restore();
      });
    }
    function addTask() {
      const input = document.getElementById("taskInput");
      const task = input.value.trim();
      if (task && !tasks.includes(task)) {
        tasks.push(task);
        input.value = "";
        drawWheel();
      }
    }
function spin() {
  if (tasks.length === 0) {
    alert("Add some tasks first!");
    return;
  }
  // Play spin sound
  const audio = document.getElementById("spinAudio");
  if (audio) audio.play();
  const sliceDeg = 360 / tasks.length;
  const duration = 10000; // 10 seconds
  const start = performance.now();
  const spins = 5 + Math.random() * 2; // Total rotations
  const startRotation = currentRotation;
  const endRotation = startRotation + spins * 360;
  function easeOutCubic(t) {
    return 1 - Math.pow(1 - t, 3);
  }
  function animate(now) {
    const elapsed = now - start;
    const t = Math.min(1, elapsed / duration);
    const easedT = easeOutCubic(t);
    currentRotation = startRotation + (endRotation - startRotation) * easedT;
    canvas.style.transform = `rotate(${currentRotation}deg)`;
    if (t < 1) {
      requestAnimationFrame(animate);
    } else {
      // Done spinning â€“ determine result
      const normalizedRotation = currentRotation % 360;
      const pointerAngle = (360 - normalizedRotation + 90) % 360;
      const index = Math.floor(pointerAngle / sliceDeg) % tasks.length;
      const selectedTask = tasks[index];
      result.textContent = "Result: " + selectedTask;
      // Send to opener window if needed
      if (window.opener && window.opener.document) {
        const taskTitle = window.opener.document.querySelector(".task-title");
        if (taskTitle) taskTitle.textContent = selectedTask;
      }
      // Remove selected task & redraw
      tasks.splice(index, 1);
      drawWheel();
    }
  }
  requestAnimationFrame(animate);
}
  </script>
  <audio id="spinAudio" src="wheel.mp3.mp3" preload="auto"></audio>
</body>
</html>
